<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Fitting Wizard Help</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
}

/* Style the side navigation */
.sidenav {
    height: 100%;
    width: 200px;
    position: fixed;
    z-index: 1;
    top: 0;
    left: 0;
    background-color: #a8bde0;
    overflow-x: hidden;
}


/* Side navigation links */
.sidenav a {
    color: black;
    padding: 4px;
    text-indent: 20px;
    text-decoration: none;
    display: block;
}

/* Change color on hover */
.sidenav a:hover {
    color: white;
}

/* Style the content */
.content {
    margin-left: 300px;
    padding-left: 20px;
    word-wrap: break-word;
    width: 900px;
}
</style>
  </head>
  <body dir="ltr" lang="en-GB">
    <div class="sidenav"> <br>
      <br>
      <br>
      <a href="index.html">1. Overview</a> <a href="mtpfit.html">2. MTP
        Fit</a> <a href="ljfit.html">3. LJ Fit</a> </div>
    <div class="content">
      <p style="margin-bottom: 0in; font-weight: normal" align="center"><font
          face="Liberation Sans, sans-serif"><font style="font-size:
            28pt" size="6">Fitting Web 2.0.1: Help</font></font></p>
      <p style="margin-bottom: 0in" align="left"><br>
      </p>
      <p><br>
      </p>
      <div id="MTP Fit" dir="ltr">
        <p style="margin-bottom: 0in; font-weight: normal" align="left"><font
            face="Liberation Sans, sans-serif"><font style="font-size:
              24pt" size="6">MTP Fit</font></font></p>
        <p style="margin-bottom: 0in" align="left"><font
            face="Liberation Sans, sans-serif"><font style="font-size:
              14pt" size="4">The MTP Fit (multipole fit) code is used to
              obtain atomic multipole moments in CHARMM "lpun" format
              for use in subsequent molecular dynamics simulations. See
              the original paper cited in the overview for more details,
              but very briefly the approach is to take an optimized
              molecule, use a quantum chemical (QM) calculation to
              obtain the electrostatic potential on a grid around this
              molecule to use as reference data, then use the molecule's
              electron density with Stone's GDMA analysis to obtain an
              initial guess for the atomic multipoles. Fitting then
              proceeds by constraining charges to near GDMA values
              within a user-defined tolerance and gradually refining the
              multipoles to reduce the discrepancy between the QM
              reference ESP and the ESP generated by the fitted atomic
              multipole moments.<br>
            </font></font></p>
        <p style="margin-bottom: 0in; font-weight: normal" align="left"><font
            face="Liberation Sans, sans-serif"><font style="font-size:
              14pt" size="4">The basic workflow for multipole fitting in
              the Fitting Wizard is therefore as follows:</font></font></p>
        <p style="margin-bottom: 0in" align="left"><br>
        </p>
        <ol>
          <li>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"> <a
                href="#Upload_molecule_in_xyz_file_format"><font
                  face="Liberation Sans, sans-serif" color="#3366ff"><font
                    style="font-size: 14pt" size="4">Upload molecule in
                    xyz file format</font></font></a></p>
          </li>
          <li>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"> <a
                href="#Specify_QM_calculation_parameters"><font
                  face="Liberation Sans, sans-serif" color="#3366ff"><font
                    style="font-size: 14pt" size="4">Specify QM
                    calculation parameters</font></font></a></p>
          </li>
          <li>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"> <a href="#Check_generated_GDMA_charges"><font
                  face="Liberation Sans, sans-serif" color="#3366ff"><font
                    style="font-size: 14pt" size="4">Check generated
                    GDMA charges</font></font></a></p>
          </li>
          <li>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"> <a href="#Specify_fitting_parameters"><font
                  face="Liberation Sans, sans-serif" color="#3366ff"><font
                    style="font-size: 14pt" size="4">Specify fitting
                    parameters</font></font></a></p>
          </li>
          <li>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"> <a href="#Inspect_fitting_results"><font
                  face="Liberation Sans, sans-serif" color="#3366ff"><font
                    style="font-size: 14pt" size="4">Inspect fitting
                    results and refine fitting parameters for further
                    cycles as necessary</font></font></a></p>
          </li>
        </ol>
        <p style="margin-bottom: 0in" align="left"><br>
        </p>
        <p style="margin-bottom: 0in; font-weight: normal" align="left"><font
            face="Liberation Sans, sans-serif"><font style="font-size:
              14pt" size="4">In more detail:</font></font></p>
        <p style="margin-bottom: 0in" align="left"><br>
        </p>
        <ol>
          <li>
            <p style="margin-top: 0.17in; page-break-after: avoid"><font
                face="Albany, sans-serif" color="#3366ff"><font
                  style="font-size: 14pt" size="4"><a
                    name="Upload_molecule_in_xyz_file_format"></a>Upload
                  molecule in xyz file format</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4"><img src="mtp-1.png"
                    alt="Screenshot 1" width="680" height="439"><br>
                  <br>
                  The multipoles that are generated are strictly
                  speaking optimized only for the geometry of the
                  molecule that you upload. No geometry optimization or
                  conformational sampling will be performed by the
                  fitting wizard, so make sure that you select this
                  geometry carefully before uploading. In addition, the
                  MTPL routine in CHARMM relies on atom ordering to map
                  the fitted multipole parameters to the atom types,
                  coordinates and other parameters in the topology and
                  PDB files for subsequent simulations. It is therefore
                  highly recommended that you keep the atom ordering in
                  your initial xyz file the same as the ordering in the
                  residue definition in your topology file, and ideally
                  also keep it the same in your coordinate / PDB files
                  throughout to avoid possible confusion in assigning
                  multipoles to the correct atom types and in correctly
                  defining the local axis systems used to define
                  multipole directionality.</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">After uploading your
                  file, you will be invited to check the geometry in a
                  3D viewing window before proceeding to the next step.</font></font></p>
          </li>
          <li>
            <p style="margin-top: 0.17in; page-break-after: avoid"><font
                face="Albany, sans-serif" color="#3366ff"><font
                  style="font-size: 14pt" size="4"><a
                    name="Specify_QM_calculation_parameters"></a>Specify
                  QM calculation parameters</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4"><img src="mtp-2.png"
                    alt="Screenshot 2" width="680" height="315"><br>
                  <br>
                  The “Gaussian 09” suite is currently the QM engine
                  used to generate a reference electrostatic potential
                  grid (“cube” file) to provide reference data for
                  subsequent ESP fitting. The Fitting Wizard UI gives
                  the option to select the desired level of theory by
                  specifying only the command-line section of the
                  Gaussian input file (see Gaussian manual for further
                  details). The default value will run a calculation at
                  the MP2/aug-cc-pVDZ level of theory. The number of
                  cores requested for the job can be given (make sure
                  you choose a value that is suitable for the cluster
                  where the Gaussian job will be run, or simply leave
                  the default value). The molecular charge and spin
                  multiplicity are required for all QM calculations to
                  define the electronic configuration.</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">Once you submit the
                  calculation a progress bar will keep you updated with
                  which step of the process your job has reached. Note
                  that generating the ESP grid can take some time for
                  larger molecules, as the number of points to be
                  evaluated scales roughly with the size of the molecule
                  cubed. Aside from this Stone's “GDMA” program will be
                  used to generate initial guess charges for each atom
                  based on GDMA charge partitioning.</font></font></p>
          </li>
          <li>
            <p style="margin-top: 0.17in; page-break-after: avoid"><font
                face="Albany, sans-serif" color="#3366ff"><font
                  style="font-size: 14pt" size="4"><a
                    name="Check_generated_GDMA_charges"></a>Check
                  generated GDMA charges</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4"><img src="mtp-3.png"
                    alt="Screenshot 3" width="680" height="622"><br>
                  <br>
                  Clicking “proceed” once calculations have finished
                  shows initial GDMA guess charges and a 3D molecule
                  viewer window. Moving the mouse over each atom type in
                  the list of atom types and GDMA charges will highlight
                  the corresponding atom in the molecule viewer window
                  to help with atom identification. Atomic charges can
                  be altered by hand at this stage if desired, otherwise
                  clicking “start session” will continue to the "fitting
                  parameters" page.</font></font></p>
          </li>
          <li>
            <p style="margin-top: 0.17in; page-break-after: avoid"><font
                face="Albany, sans-serif" color="#3366ff"><font
                  style="font-size: 14pt" size="4"><a
                    name="Specify_fitting_parameters"></a>Specify
                  fitting parameters</font></font></p>
            <p style="margin-bottom: 0in" align="left"><font
                face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4"><span
                    style="font-weight: normal"><img src="mtp-4.png"
                      alt="Screenshot 4" width="680" height="473"><br>
                    <br>
                    The </span></font></font><font style="font-size:
                14pt" size="4"><font style="font-size: 14pt" size="4"><span
                    style="font-weight: normal">λ</span></font><font
                  size="-2" face="Liberation Sans, sans-serif"><font
                    style="font-size: 14pt"><span style="font-weight:
                      normal"></span></font></font><font size="-2"><sub><span
                      style="font-weight: normal">PC</span></sub></font>
              </font> <font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">parameter is a
                  requested “maximum deviation” (hard constraint) for
                  the charge component of the fitted multipole moments
                  from their initial GDMA (or user-defined) values. Note
                  that initial charges can still be changed once fitting
                  parameters have been defined before the fitting
                  process begins by clicking “start a fit. Although </font></font><font
                style="font-size: 14pt" size="4"><font style="font-size:
                  14pt" size="4"><span style="font-weight: normal">λ</span></font><font
                  size="-2" face="Liberation Sans, sans-serif"><font
                    style="font-size: 14pt"><span style="font-weight:
                      normal"></span></font></font><font size="-2"><sub><span
                      style="font-weight: normal">PC</span></sub></font>
                is meant as a hard constraint, if no solution is found
                that satisfies this constraint within a fixed number of
                fitting cycles a solution that violates the constraint
                will be presented, so be sure to check this once results
                have been generated if necessary.</font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">The rank of the
                  expansion refers to the maximum multipole rank that
                  will be fitted. CHARMM's MTPL module supports up to
                  quadrupole, so atomic charges, charges plus dipoles,
                  or charges plus dipoles plus quadrupoles can be
                  selected.</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">The “Ignore all
                  hydrogen multipoles” checkbox can be used to truncate
                  the multipole expansion on hydrogen atoms at monopole
                  (charge-only). This usually incurs little cost in
                  terms of accuracy of the fit, but can significantly
                  speed up subsequent MD simulations due to the reduced
                  number of terms to be evaluated for electrostatic
                  interactions.</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">Clicking “start a
                  fit” will launch a pop-up window where the initial
                  charges can be modified as necessary, otherwise
                  clicking “start fitting” will begin fitting atomic
                  multipole moments to the QM ESP reference data
                  calculated in the previous steps.</font></font></p>
          </li>
          <li>
            <p style="margin-top: 0.17in; page-break-after: avoid"><font
                face="Albany, sans-serif" color="#3366ff"><font
                  style="font-size: 14pt" size="4"><a
                    name="Inspect_fitting_results"></a>Inspect fitting
                  results and refine fitting parameters for further
                  cycles as necessary</font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4"><img src="mtp-5.png"
                    alt="Screenshot 5" width="680" height="426"><br>
                  <br>
                  Once the fitting code has completed you can proceed to
                  the results screen for this fit. The results screen
                  shows the RMSE of the ESP fit with each fitted
                  multipole component, and offers the chance to download
                  the results in “lpun” format that can be used directly
                  with the MTPL routine in CHARMM. If multiple fits have
                  already been performed then the “Fit” dropdown menu
                  allows you to select which fit results and files you'd
                  like to view. </font></font> </p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">Any multipole
                  components that are highlighted red are simply larger
                  than an arbitrary value of 0.8 a.u. for charges or 1.2
                  a.u. for higher order multipole components. Large
                  multipole components can give good electrostatics
                  during fitting, but could potentially lead to
                  instability during simulations if two atoms with large
                  multipoles come close enough to one another to
                  overcome repulsive Lennard-Jones barriers. Results
                  with larger charges should not necessarily be
                  discarded, simply treated with caution and tested
                  properly in MD simulations.<br>
                </font></font></p>
            <p style="margin-bottom: 0in; font-weight: normal"
              align="left"><font face="Liberation Sans, sans-serif"><font
                  style="font-size: 14pt" size="4">Clicking “Session
                  overview” provides a summarized comparison of all fits
                  that belong to the current session, providing the
                  additional options to delete a fit (and with it the
                  associated files stored on the server) or to perform
                  an additional fit with new fitting parameters (note
                  that all fits belonging to the session will be saved
                  until “Start new session” is selected). Clicking “Show
                  results” from the “Session overview” page will return
                  to the detailed results view.</font></font></p>
          </li>
        </ol>
      </div>
      <div id="LJ Fit" dir="ltr">
        <p style="margin-bottom: 0in" align="left"><font
            face="Liberation Sans, sans-serif"><font style="font-size:
              14pt" size="4">Note that your session should be saved even
              after closing your browser window, so entering the same
              username at a later time allows you to resume the session
              where you left off.<br>
            </font></font></p>
        <p style="margin-bottom: 0in" align="left"><font
            face="Liberation Sans, sans-serif"><font style="font-size:
              14pt" size="4"><span style="font-weight: normal"><a
                  href="ljfit.html">Next</a>: LJ Fit</span></font></font></p>
      </div>
    </div>
  </body>
</html>
