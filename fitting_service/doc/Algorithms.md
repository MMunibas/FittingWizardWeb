# Algorithms #

Following document describes all algorithms supported by the API.

## LJ Fit ##

**Source File:** ljfit.py

**Function to call:** ljfit()

**Input files:**
 * [name].par CHARMM parameter file
 * [liq_name].pdb pure liquid PDB file
 * [solute_name].pdb solute molecule PDB file
 * [solvent_name].pdb solvent PDB file
 * [name].lpun MTPL punch file
 * [name].top CHARMM topology file

**Required parameters**
 * lj_filename_charmm_topology (.top topology file for CHARMM)
 * lj_filename_solute_pdb (.pdb structure file for solute molecule)
 * lj_filename_solvent_pdb (.pdb file for solvent box)
 * lj_filename_charmm_parameter (.par file for CHARMM)
 * lj_filename_mtpl_lpun (.lpun file for CHARMM MTPL routine)
 * lj_filename_pureliquid_pdb (.pdb file for pure liquid made of solute molecules)
 * lj_ti_lambda_0 (initial lambda value for thermodynamic integration (usually 0.0))
 * lj_ti_lambda_1 (final lambda value for thermodynamic integration (usually 1.0))
 * lj_charmm_simulation_temperature (temperature for molecular dynamics simulations)
 * lj_scaling_factor_eps (LJ epsilon scaling factor for current grid point)
 * lj_scaling_factor_sig (LJ sigma scaling factor for current grid point)
 * lj_ti_lambda_window_size_electrostatic (window size for electrostatic part of TI calculation)
 * lj_ti_lambda_window_size_vdw (window size for vdw part of TI calculation)

**Generated output**
 * molar_mass (solute molar mass)
 * pure_liquid_density (density of pure liquid)
 * vaporization_enthalpy (free energy of vaporization of pure liquid)
 * solvation_free_energy (free energy of solvation of solute molecule)

## MTP Fit - Generating ##

**Source File:** mtp-part1.py

**Function to call:** mtpfit_part1()

**Input files:**
 * [name].xyz coordinate file

**Required parameters**
 * mtp_gen_filename_xyz name of uploaded xyz file
 * mtp_gen_molecule_charge total charge of uploaded molecule
 * mtp_gen_molecule_multiplicity spin multiplicity of molecule
 * mtp_gen_charge_filename json file where generated initial charges will be written
 * mtp_gen_gaussian_input_commandline e.g. MP2/aug-cc-PVDZ nosymm
 * mtp_gen_gaussian_num_cores number of cores to use for Gaussian job

**Generated output (temporary files omitted)**
 * mtpfittab.txt fitting table file in calculation output folder
 * gdma_ref.pun reference GDMA punch file containing initial (unfitted) multipole moments, also in calculation output folder
 * results.json file containing GDMA initial atomic charges with new atom labels (in run output folder)

**Temporary Files**
 * .vdw file containing atomic radii for fieldcomp and writing fitting table steps
 * [name].gdma.inp GDMA input file for calculating initial charges for fitting and for creating template punch file with multipoles
 * [name].out Gaussian calculation output file
 * [name].fchk Gaussian formatted checkpoint file to generate subsequent cube file contating reference ESP
 * [name].chk Gaussian unformatted checkpoint file used to generate formatted checkpoint file
 * gdma_original.pun punch file generated by GDMA containing initial charges and acting as template for file format
 * [name].gdma.log GDMA calculation output file
 * [name]_*.txt output files generated by fieldcomp program
 * fieldcomp.log terminal output from fieldcomp program
 * [name].sdf is an SDF file generated by OpenBabel containing bond connectivity information

## MTP Fit - Fitting ##

**Source File:** mtp-part2.py

**Function to call:** mtpfit_part2()

**Input files:**
 * mtpfittab.txt file generated by mtpfit_part1 in calculation output directory (large file so not uploaded to virtual machine)
 * mtp_gen_charge_filename file generated by web interface containing either original GDMA or user-modified atomic charges from web interface
 * gdma_ref.pun file generated by mtpfit_part1 containing GDMA multipole moments

**Required parameters**
 * mtp_fitting_table_filename (file name of fitting table file from part 1, mtpfittab.txt)
 * mtp_fitting_threshold (user-defined fitting precision entered into web interface)
 * mtp_fitting_rank (rank of highest multipole moments to be fitted, entered into web UI by user)
 * mtp_fitting_flag_ignore_H (user web UI option to fit H-atoms or not, TRUE means don't fit)
 * mtp_fitting_charge_filename (generated_charges.txt file written by web UI to contain user-defined charges)
 * mtp_fit_number (which fit is this: 1st = 0, 2nd = 1, 3rd = 2...)

**Generated output (temporary files omitted)**
 * fitted results file "fit_X.txt" in the local run output folder where "X" is the number of the fit
 * .lpun file containing fitted multipole moments in the local run output folder
 * results.json file in the local run output folder containing fit number passed from web interface, RMSE of fit and multipole rank of fit

** Temporary Files
 * fit_[X].txt contains the terminal output from the fit_mtp routine
 * fit_[X].pun contains the fitted multipoles in the global axis system in GDMA punch file format


